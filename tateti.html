<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ta-Te-Ti Rocky ü•ä</title>
<style>
  body {
    margin:0;
    font-family:'Arial',sans-serif;
    background-color:#FFD700;
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:1rem;
    min-height:100vh;
  }

  h1 {
    font-family:'Impact',sans-serif;
    font-size:6vw;
    color:#FFD700;
    -webkit-text-stroke:2px #D32F2F;
    text-align:center;
    margin:1rem 0;
  }

  #menu {
    display:flex;
    flex-direction:column;
    align-items:center;
    margin-bottom:1rem;
    gap:1rem;
  }

  #menu button {
    padding:1rem 2rem;
    font-size:1.2rem;
    font-weight:bold;
    color:#FFD700;
    background-color:#B71C1C;
    border:none;
    border-radius:12px;
    cursor:pointer;
  }

  #menu button:hover{
    background-color:#D32F2F;
    transform:translateY(-2px);
  }

  #board {
    display:grid;
    grid-template-columns:repeat(3,100px);
    grid-template-rows:repeat(3,100px);
    gap:10px;
    margin-bottom:1rem;
    display:none;
  }

  .cell {
    background-color:#FFF59D;
    border:2px solid #D32F2F;
    display:flex;
    justify-content:center;
    align-items:center;
    font-size:3rem;
    cursor:pointer;
    position:relative;
  }

  .cell img {
    max-width:80%;
    max-height:80%;
  }

  #message {
    font-family:'Oswald',sans-serif;
    font-size:1.5rem;
    color:#D32F2F;
    margin-bottom:1rem;
    text-align:center;
  }

  button.game-btn {
    padding:1rem 2rem;
    font-size:1.2rem;
    font-weight:bold;
    color:#FFD700;
    background-color:#B71C1C;
    border:none;
    border-radius:12px;
    cursor:pointer;
    margin:0.5rem;
  }

  button.game-btn:hover {
    background-color:#D32F2F;
    transform:translateY(-2px);
  }

  @media(max-width:500px){
    #board{ grid-template-columns:repeat(3,70px); grid-template-rows:repeat(3,70px); }
  }
</style>
</head>
<body>

<h1>Ta-Te-Ti Rocky ü•ä</h1>

<div id="menu">
  <button onclick="startGame('cpu')">Vs M√°quina</button>
  <button onclick="startGame('2p')">2 Jugadores</button>
</div>

<div id="message"></div>
<div id="board"></div>

<button class="game-btn" onclick="startGame(currentMode)">üîÑ Reiniciar</button>
<button class="game-btn" onclick="location.href='index.html'">üè† Volver al inicio</button>

<script>
const boardEl = document.getElementById('board');
const messageEl = document.getElementById('message');
let cells = [];
let gameOver = false;
let currentMode = null;
let currentPlayer = 'user';
const userSymbol = 'ü•ä';
const compSymbol = 'rocky.png';

function startGame(mode){
  currentMode = mode;
  boardEl.style.display='grid';
  document.getElementById('menu').style.display='none';
  cells = Array(9).fill(null);
  gameOver=false;
  currentPlayer='user';
  boardEl.innerHTML='';
  messageEl.textContent = currentMode==='cpu'? 'Tu turno ü•ä':'Jugador 1 ü•ä';

  for(let i=0;i<9;i++){
    const cell = document.createElement('div');
    cell.classList.add('cell');
    cell.dataset.index=i;
    cell.addEventListener('click',()=>handleMove(i,cell));
    boardEl.appendChild(cell);
  }
}

function handleMove(i,cell){
  if(gameOver || cells[i]) return;

  if(currentMode==='2p'){
    const symbol = currentPlayer==='user'? userSymbol:compSymbol;
    if(symbol===compSymbol){
      const img=document.createElement('img');
      img.src=compSymbol;
      cell.appendChild(img);
    } else cell.textContent = symbol;

    cells[i]=symbol;
    if(checkWin(symbol)){
      messageEl.textContent = currentPlayer==='user'?'¬°Jugador 1 gana! ü•≥':'¬°Jugador 2 gana! ü•≥';
      gameOver=true;
      return;
    }
    if(cells.every(c=>c!==null)){ messageEl.textContent='¬°Empate! ü§ù'; gameOver=true; return; }
    currentPlayer=currentPlayer==='user'?'comp':'user';
    messageEl.textContent = currentPlayer==='user'?'Jugador 1 ü•ä':'Jugador 2 ü•ä';
  } else {
    // vs CPU
    cells[i]='user';
    cell.textContent=userSymbol;
    if(checkWin(userSymbol)){ messageEl.textContent='¬°Ganaste! ü•≥'; gameOver=true; return; }
    if(cells.every(c=>c!==null)){ messageEl.textContent='¬°Empate! ü§ù'; gameOver=true; return; }
    messageEl.textContent='Turno de Rocky...';
    setTimeout(compMove,400);
  }
}

function compMove(){
  if(gameOver) return;

  const bestMove = minimax(cells,'comp').index;
  cells[bestMove]='comp';
  const cell = boardEl.querySelector(`[data-index='${bestMove}']`);
  const img=document.createElement('img');
  img.src=compSymbol;
  cell.appendChild(img);

  if(checkWin('comp')){ messageEl.textContent='Rocky gana ü•äüí•'; gameOver=true; return; }
  if(cells.every(c=>c!==null)){ messageEl.textContent='¬°Empate! ü§ù'; gameOver=true; return; }
  messageEl.textContent='Tu turno ü•ä';
}

function checkWin(symbol){
  const combos=[
    [0,1,2],[3,4,5],[6,7,8],
    [0,3,6],[1,4,7],[2,5,8],
    [0,4,8],[2,4,6]
  ];
  for(let combo of combos){
    if(combo.every(i=>cells[i]===symbol || (symbol==='comp' && cells[i]==='comp'))) return true;
  }
  return false;
}

function emptyIndexes(board){
  return board.map((v,i)=>v===null? i:null).filter(v=>v!==null);
}

function minimax(newBoard, player){
  const availSpots = emptyIndexes(newBoard);

  if(checkWin('user')) return {score:-10};
  else if(checkWin('comp')) return {score:10};
  else if(availSpots.length===0) return {score:0};

  let moves=[];
  for(let i=0;i<availSpots.length;i++){
    let move = {};
    move.index=availSpots[i];
    newBoard[availSpots[i]] = player==='comp'? 'comp':'user';

    let result = minimax(newBoard, player==='comp'?'user':'comp');
    move.score=result.score;

    newBoard[availSpots[i]]=null;
    moves.push(move);
  }

  let bestMove;
  if(player==='comp'){
    let bestScore=-10000;
    for(let i=0;i<moves.length;i++){
      if(moves[i].score>bestScore){
        bestScore=moves[i].score;
        bestMove=i;
      }
    }
  } else {
    let bestScore=10000;
    for(let i=0;i<moves.length;i++){
      if(moves[i].score<bestScore){
        bestScore=moves[i].score;
        bestMove=i;
      }
    }
  }
  return moves[bestMove];
}
</script>

</body>
</html>
